# vim: ft=gitconfig
[core]
  excludesfile = ./ignore_global
[rerere]
  enabled = true
[push]
  default = simple
[merge]
  tool = vimdiff
  conflictstyle = diff3
[diff]
  tool = vimdiff
  algorithm = histogram
[pager]
  lg = false
[alias]
  root = rev-parse --show-toplevel
  upstream = !git rev-parse --abbrev-ref @{upstream} 
  run = "!f() { "$@" "`git root`"; }; f"
  checkoud-submodules = submodule update -f --checkout
  changes = status --porcelain=1 -uall
  affected = !git show --format="" --name-only
  showd = show --format=""
  dirty = ls-files -o --exclude-standard
  changed = !git ls-files -t -c -d -m -k -o --directory --exclude-standard | grep -v "^H" | cut -d\" \" -f 2

  x = ext

  xphab = ext phab
  xmark = ext meta
  xstack = ext stack

  xlabel = !git ext stack label && git lg
  xlabeld = ext stack label -d

  xedit = ext stack edit

  xland = !git x phab sync && git x phab land
  xupload = !git branch | cut -c 3- | grep 'D/.*' | xargs git-rstash origin
  xsw = "!f() { git commit --all -m 'SQUASH' && git checkout $1; }; f"

  # stag = ext stack label
  # stag = !git log $(git merge-base $(git upstream) HEAD)~1..HEAD --format='%H' | tail -r | nl -ba -s ' ' -n rz -w 2 -v 0 | sed 's:^:D/:g' | xargs -n 2 git branch --create-reflog -f
  # dstag = !git branch | grep -E 'D/\\d+' | xargs -n 1 git branch --create-reflog -D

  dephab = !git tag | grep phabricator | xargs -n 1 git tag -d

  f = fetch -n
  b = branch
  st = status
  co = checkout

  d = diff
  dc = diff --cached
  diffc = diff --cached

  cm = commit -m
  cma = commit --all -m

  cc = commit
  cca = commit --amend -C HEAD
  ccam = commit --amend

  cp = cherry-pick

  rb = rebase
  rbu = !git rebase $(git upstream)
  rbi = rb -i

  su = submodule update
  suc = submodule update --checkout

  lsa = ls-files --exclude-standard

  lgf = lg --follow

  lg = log --pretty=tformat:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit -n 10
  lgg = log --graph --pretty=tformat:'%Cred%h%Creset -%C(yellow)%d%Creset %s %Cgreen(%cr) %C(bold blue)<%an>%Creset' --abbrev-commit -n 10

  lgd = !git lg -n 100 HEAD..

  lgud = !git lg -n 100 $(git upstream)..HEAD
  lgdu = !git lg -n 100 HEAD..$(git upstream)

  fpull = pull --ff-only
  fmerge = merge --ff-only

  untrack = update-index --assume-unchanged
  track = update-index --no-assume-unchanged

  untracked = !git ls-files -v | grep "^[[:lower:]]" | perl -pe "s/^\\\\w+\\\\s+//"

  # oldest-ancestor = !bash -c 'diff --old-line-format='' --new-line-format='' <(git rev-list --first-parent "${1:-master}") <(git rev-list --first-parent "${2:-HEAD}") | head -1' -
  # stag = !git log $(git merge-base $(git upstream) HEAD)~1..HEAD --format='%H' | tail -r | nl -ba -s ' ' -n rz -w 2 -v 0 | sed 's:^:D/:g' | xargs -n 2 git branch --create-reflog -f
  # dstag = !git branch | grep -E 'D/\\d+' | xargs -n 1 git branch --create-reflog -D
[tig "color"]
  cursor = green black
  title-focus = green black
  title-blur = white black
[difftool "sourcetree"]
  cmd = /Applications/SourceTree.app/Contents/Resources/opendiff-w.sh \"$LOCAL\" \"$REMOTE\"
  path = 
[mergetool "sourcetree"]
  cmd = /Applications/SourceTree.app/Contents/Resources/opendiff-w.sh \"$LOCAL\" \"$REMOTE\" -ancestor \"$BASE\" -merge \"$MERGED\"
  trustExitCode = true
[mergetool "vscode"]
  cmd = code --wait $MERGED
