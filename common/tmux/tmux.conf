#######################################################################
#                           Global Settings                           #
#######################################################################

set-option -g set-titles on
set-option -ga terminal-overrides ",xterm-*:Tc"

set -g default-shell $SHELL 
set -g default-terminal "screen-256color"

# Making Tmux more like vim
setw -g mode-keys vi
setw -g aggressive-resize on

# Misc settings
set -sg escape-time 10
set -g xterm-keys on
set -g history-limit 20000

# wrap default shell in reattach-to-user-namespace if available
# there is some hack with `exec & reattach`, credits to "https://github.com/gpakosz/.tmux"
# don't really understand how it works, but at least window are not renamed to "reattach-to-user-namespace"
if -b "command -v reattach-to-user-namespace > /dev/null 2>&1" \
    "run 'tmux set -g default-command \"exec $(tmux show -gv default-shell) 2>/dev/null & reattach-to-user-namespace -l $(tmux show -gv default-shell)\"'"
# set -g default-command "\
# which reattach-to-user-namespace > /dev/null && reattach-to-user-namespace -l ${SHELL} \
# "

#######################################################################
#                                @VARS                                #
#######################################################################

# [Colors]
C_W="#[default]#[fg=White]"
C_C="#[default]#[fg=Cyan]"
C_K="#[default]#[fg=black]"
C_LW="#[default]#[fg=colour14]"
C_BG="#[default]#[fg=Green,bold]"
C_BW="#[default]#[fg=White,bold]"
C_BR="#[default]#[fg=Red,bold]"
C_BR="#[default]#[fg=Red,bold]"
# [/Colors]

# [Prompts]
WIN_L_PROMPT="#{C_LW}[#{C_BG}#(whoami)#{C_BW}@#{C_BR}#(hostname)#{C_LW}]:#{C_W}"
WIN_L_PROMPT_DISABLED="#{C_W}[DISABLED]: #{C_K}#(whoami)@#(hostname): #{C_K}"

WIN_R_PROMPT="#{C_C}#S #{C_W}%a %d %b %R"
WIN_R_PROMPT_DISABLED="#{C_K}#S %a %d %b %R"
# [/Prompts]

#######################################################################
#                            Change Prefix                            #
#######################################################################
unbind C-b
set -g prefix C-a

# Allow passing the `sceen` button to other apps
bind-key C-a send-keys C-a

# Set up so that pane indicies start at 1
set -g base-index 1
setw -g pane-base-index 1

# Turn off KEYS
bind -T root F12 \
  set prefix None \;\
  set key-table off \;\
  set status-style 'bg=red,fg=white'\;\
  set status-left $WIN_L_PROMPT_DISABLED \;\
  set status-right $WIN_R_PROMPT_DISABLED \;\
  if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
  refresh-client -S \;\

bind -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  set -u status-style \;\
  set -u status-right \;\
  set -u status-left \;\
  refresh-client -S \;\

# I often hit Ctrl-D by accident, I don't like it
set-environment -g 'IGNOREEOF' 2

# Setting R to resource the config
bind r source-file ~/.tmux.conf

#######################################################################
#                               Prompts                               #
#######################################################################

# Rename your terminals
set -g set-titles on
set -g set-titles-string 'tmux[#S/#W(#T)]'

# Status bar customization
set -g status-style 'fg=colour230' 
set -g status-interval 5
set -g status-left-length 90
set -g status-right-length 60
set -g status-justify left
set -g status-left $WIN_L_PROMPT
set -g status-right $WIN_R_PROMPT

# Window customization
set -g window-style 'fg=colour250,bg=colour235'
set -g window-active-style 'fg=default,bg=colour233'

#######################################################################
#                              Copy Mode                              #
#######################################################################

bind Tab copy-mode
bind-key -T copy-mode-vi Tab send-keys -X copy-selection-and-cancel

# Immitate vim behaviour
bind-key -T copy-mode-vi 'v' send-keys -X begin-selection
bind-key -T copy-mode-vi 'y' send-keys -X copy-selection
bind-key -T copy-mode-vi 'r' send-keys -X rectangle-toggle

bind-key -T copy-mode-vi WheelUpPane send -N"2" -X scroll-up
bind-key -T copy-mode-vi WheelDownPane send -N"2" -X scroll-down

# Copy into system clipboard (currently mac OS)
bind y run 'tmux save-buffer - | pbcopy'
bind p run 'pbpaste | tmux save-buffer -'

#######################################################################
#                           Window Managent                           #
#######################################################################

# Binding switching panes to F1 key
bind-key -n F1 select-pane -t :.+
bind-key -n S-F1 select-pane -t :.-

# Binding expand contract to F2 key
bind-key -n F2 resize-pane -Z

# Navigate panes like Vim.
bind-key C-j select-pane -D
bind-key C-k select-pane -U
bind-key C-h select-pane -L
bind-key C-l select-pane -R

# Resize panes with arrows
bind-key Down resize-pane -D 5
bind-key Up resize-pane -U 5
bind-key Left resize-pane -L 5
bind-key Right resize-pane -R 5

# Rebinding split window to create pane with the same directory
bind '"' split-window -c '#{pane_current_path}' -v
bind-key -n F3 split-window -c '#{pane_current_path}' -v
bind % split-window -c '#{pane_current_path}' -h
bind-key -n F4 split-window -c '#{pane_current_path}' -h

# Rebinding new window to create window with the same dir
bind c new-window -c '#{pane_current_path}'
bind-key -n F5 new-window -c '#{pane_current_path}'


# Settign up pane synchronisation mechanism
bind b setw synchronize-panes off \;\
       display 'Sync: OFF'
bind B setw synchronize-panes on \;\
       display 'Sync: ON'

# Setting up mouse integration
set -g mouse
bind m set -g mouse off \;\
       display 'Mouse: OFF'
bind M set -g mouse on \;\
       display 'Mouse: ON'

